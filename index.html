<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéì Twibbon HSA - Pembuat Twibbon Sekolah</title>
    <style>
        :root {
            --primary: #1e40af;
            --primary-dark: #1e3a8a;
            --secondary: #3b82f6;
            --accent: #60a5fa;
            --bg-light: #f0f9ff;
            --bg-white: #ffffff;
            --text-dark: #1e293b;
            --text-light: #64748b;
            --shadow: rgba(30, 64, 175, 0.15);
        }

        [data-theme="dark"] {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #1e40af;
            --accent: #60a5fa;
            --bg-light: #0f172a;
            --bg-white: #1e293b;
            --text-dark: #f1f5f9;
            --text-light: #cbd5e1;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            transition: background 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
            opacity: 0.05;
        }

        .bg-animation::before {
            content: 'üéì';
            position: absolute;
            font-size: 100px;
            opacity: 0.1;
            animation: float 20s infinite ease-in-out;
        }

        @keyframes float {
            0%, 100% { transform: translate(10%, 10%) rotate(0deg); }
            25% { transform: translate(80%, 20%) rotate(90deg); }
            50% { transform: translate(70%, 80%) rotate(180deg); }
            75% { transform: translate(20%, 70%) rotate(270deg); }
        }

        /* Navigation */
        nav {
            background: var(--bg-white);
            padding: 15px 0;
            box-shadow: 0 2px 10px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-menu {
            display: flex;
            gap: 30px;
            list-style: none;
            align-items: center;
        }

        .nav-menu a {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            position: relative;
        }

        .nav-menu a:hover {
            color: var(--primary);
        }

        .nav-menu a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary);
            transition: width 0.3s;
        }

        .nav-menu a:hover::after {
            width: 100%;
        }

        .theme-toggle {
            background: var(--primary);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(180deg);
        }

        /* Mobile Menu Toggle */
        .menu-toggle {
            display: none;
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2em;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* Hero Section */
        .hero {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 60px 40px;
            text-align: center;
            box-shadow: 0 10px 30px var(--shadow);
            margin-bottom: 40px;
            animation: fadeInUp 0.8s ease;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: 'üìö‚úèÔ∏èüéí';
            position: absolute;
            top: -20px;
            right: -20px;
            font-size: 120px;
            opacity: 0.05;
            transform: rotate(-15deg);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hero h1 {
            font-size: 3em;
            color: var(--primary);
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px var(--shadow);
        }

        .hero p {
            font-size: 1.3em;
            color: var(--text-light);
            margin-bottom: 10px;
        }

        .hero .school-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .info-badge {
            background: var(--primary);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Card */
        .card {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px var(--shadow);
            margin-bottom: 30px;
            animation: fadeInUp 0.8s ease;
            animation-fill-mode: both;
        }

        .card:nth-child(2) { animation-delay: 0.1s; }
        .card:nth-child(3) { animation-delay: 0.2s; }
        .card:nth-child(4) { animation-delay: 0.3s; }

        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8em;
        }

        /* Template Grid */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .template-item {
            border: 3px solid var(--accent);
            border-radius: 15px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: var(--bg-light);
            position: relative;
            overflow: hidden;
        }

        .template-item::before {
            content: '';
            position: absolute;
            top: -100%;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(transparent, var(--primary));
            opacity: 0;
            transition: all 0.4s;
        }

        .template-item:hover::before {
            top: 0;
            opacity: 0.2;
        }

        .template-item:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 15px 30px var(--shadow);
        }

        .template-item.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 10px 25px var(--shadow);
        }

        .template-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .template-item p {
            font-weight: 600;
        }

        .template-item.active p {
            color: white;
        }

        /* Upload Custom Template */
        .upload-custom {
            border: 2px dashed var(--primary);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--bg-light);
        }

        .upload-custom:hover {
            background: var(--accent);
            color: white;
            transform: scale(1.02);
        }

        /* Upload Section */
        .upload-box {
            border: 3px dashed var(--primary);
            border-radius: 15px;
            padding: 50px;
            background: var(--bg-light);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .upload-box::after {
            content: 'üì∏';
            position: absolute;
            font-size: 200px;
            opacity: 0.03;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
        }

        .upload-box:hover {
            border-color: var(--secondary);
            background: var(--accent);
            color: white;
            transform: translateY(-5px);
            box-shadow: 0 15px 40px var(--shadow);
        }

        .upload-box.dragover {
            border-color: var(--secondary);
            background: var(--primary);
            color: white;
            transform: scale(1.03);
        }

        .upload-icon {
            font-size: 5em;
            margin-bottom: 15px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        input[type="file"] {
            display: none;
        }

        /* Canvas & Controls */
        #canvas {
            max-width: 100%;
            height: auto;
            border-radius: 15px;
            box-shadow: 0 15px 40px var(--shadow);
            margin: 20px 0;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .control-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--text-dark);
            font-weight: 600;
            font-size: 1.1em;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, var(--primary), var(--accent));
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
            box-shadow: 0 2px 10px var(--shadow);
            transition: all 0.3s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: var(--secondary);
            transform: scale(1.3);
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 35px;
            font-size: 1.1em;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 5px 15px var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px var(--shadow);
        }

        .btn-secondary {
            background: #64748b;
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
            transform: translateY(-3px);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-3px) scale(1.05);
        }

        /* Share Buttons */
        .share-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .share-btn {
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .share-fb { background: #1877f2; }
        .share-tw { background: #1da1f2; }
        .share-wa { background: #25d366; }
        .share-ig { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); }

        /* History */
        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .history-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px var(--shadow);
        }

        .history-item:hover {
            transform: scale(1.05);
        }

        .history-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .history-item .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 1em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Gallery Section */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .gallery-item {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 25px var(--shadow);
            transition: all 0.3s;
        }

        .gallery-item:hover {
            transform: translateY(-10px);
        }

        .gallery-item img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }

        /* Footer */
        footer {
            background: var(--bg-white);
            padding: 50px 20px 20px;
            margin-top: 60px;
            box-shadow: 0 -5px 20px var(--shadow);
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
        }

        .footer-section h3 {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .footer-section p, .footer-section a {
            color: var(--text-light);
            line-height: 1.8;
            text-decoration: none;
            display: block;
            margin-bottom: 10px;
        }

        .footer-section a:hover {
            color: var(--primary);
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .social-links a {
            width: 45px;
            height: 45px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            transition: all 0.3s;
        }

        .social-links a:hover {
            transform: translateY(-5px) rotate(360deg);
            box-shadow: 0 5px 15px var(--shadow);
        }

        .footer-bottom {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid var(--bg-light);
            color: var(--text-light);
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 5px solid var(--bg-light);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .menu-toggle {
                display: block;
            }

            .nav-menu {
                display: none;
                width: 100%;
                flex-direction: column;
                padding: 20px 0;
            }

            .nav-menu.active {
                display: flex;
            }

            .hero h1 {
                font-size: 2em;
            }

            .hero p {
                font-size: 1.1em;
            }

            .template-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .controls {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="bg-animation"></div>

    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo">
                <span>üéì</span>
                <span>HSA Twibbon</span>
            </div>
            <button class="menu-toggle" onclick="toggleMenu()">‚ò∞</button>
            <ul class="nav-menu" id="navMenu">
                <li><a href="#home">Home</a></li>
                <li><a href="#creator">Buat Twibbon</a></li>
                <li><a href="#gallery">Gallery</a></li>
                <li><a href="#about">Tentang</a></li>
                <li><a href="#contact">Kontak</a></li>
                <li><button class="theme-toggle" onclick="toggleTheme()">üåô</button></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <!-- Hero Section -->
        <section class="hero" id="home">
            <h1>üéì Twibbon HSA Generator</h1>
            <p>Buat twibbon keren untuk acara sekolah kamu dengan mudah!</p>
            <p style="font-size: 1em; color: var(--text-light); margin-top: 10px;">
                Platform resmi pembuatan twibbon untuk seluruh kegiatan HSA
            </p>
            <div class="school-info">
                <span class="info-badge">üìö SMK HSA</span>
                <span class="info-badge">üé® 100% Gratis</span>
                <span class="info-badge">‚ö° Instant Download</span>
            </div>
        </section>

        <!-- Creator Section -->
        <section id="creator">
            <!-- Template Selection -->
            <div class="card">
                <h2>üìã Pilih Template Twibbon</h2>
                <div class="template-grid" id="templateGrid"></div>
                
                <div class="upload-custom" onclick="document.getElementById('customFrameInput').click()">
                    <div style="font-size: 3em; margin-bottom: 10px;">‚ûï</div>
                    <p><strong>Upload Template Sendiri</strong></p>
                    <p style="font-size: 0.9em; color: var(--text-light);">Punya template custom? Upload di sini!</p>
                </div>
                <input type="file" id="customFrameInput" accept="image/*">
            </div>

            <!-- Upload Photo -->
            <div class="card">
                <h2>üì∏ Upload Foto Kamu</h2>
                <div class="upload-box" id="uploadBox" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">üì∑</div>
                    <h3>Klik atau Drag & Drop</h3>
                    <p>Format: JPG, PNG (Maksimal 5MB)</p>
                </div>
                <input type="file" id="fileInput" accept="image/*">
            </div>

            <!-- Loading -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p style="color: var(--primary); font-weight: 600; font-size: 1.2em;">Memproses foto...</p>
            </div>

            <!-- Preview & Controls -->
            <div class="card hidden" id="previewSection">
                <h2>‚ú® Preview & Edit</h2>
                
                <div class="controls">
                    <div class="control-group">
                        <label>üîç Zoom: <span id="scaleValue">1.0</span>x</label>
                        <input type="range" id="scaleSlider" min="0.5" max="3" step="0.1" value="1">
                    </div>
                    <div class="control-group">
                        <label>‚ÜîÔ∏è Horizontal: <span id="xValue">0</span></label>
                        <input type="range" id="xSlider" min="-300" max="300" step="1" value="0">
                    </div>
                    <div class="control-group">
                        <label>‚ÜïÔ∏è Vertikal: <span id="yValue">0</span></label>
                        <input type="range" id="ySlider" min="-300" max="300" step="1" value="0">
                    </div>
                </div>

                <div style="text-align: center;">
                    <canvas id="canvas" width="1000" height="1000"></canvas>
                </div>

                <div class="button-group">
                    <button class="btn-success" onclick="downloadImage()">
                        üíæ Download Twibbon
                    </button>
                    <button class="btn-primary" onclick="saveToHistory()">
                        üíº Simpan ke History
                    </button>
                    <button class="btn-secondary" onclick="resetAll()">
                        üîÑ Reset
                    </button>
                </div>

                <!-- Share Section -->
                <div style="margin-top: 30px; text-align: center;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">üì± Share ke Social Media</h3>
                    <div class="share-buttons">
                        <button class="share-btn share-fb" onclick="shareToFacebook()">
                            üìò Facebook
                        </button>
                        <button class="share-btn share-tw" onclick="shareToTwitter()">
                            üê¶ Twitter
                        </button>
                        <button class="share-btn share-wa" onclick="shareToWhatsApp()">
                            üí¨ WhatsApp
                        </button>
                        <button class="share-btn share-ig" onclick="shareToInstagram()">
                            üì∑ Instagram
                        </button>
                    </div>
                </div>
            </div>

            <!-- History -->
            <div class="card">
                <h2>üìö History Twibbon Kamu</h2>
                <div class="history-grid" id="historyGrid">
                    <p style="color: var(--text-light);">Belum ada history. Buat twibbon pertama kamu!</p>
                </div>
            </div>
        </section>

        <!-- Gallery Section -->
        <section class="card" id="gallery">
            <h2>üñºÔ∏è Gallery Karya Siswa</h2>
            <p style="color: var(--text-light); margin-bottom: 20px;">
                Lihat karya-karya twibbon dari siswa-siswi HSA lainnya!
            </p>
            <div class="gallery-grid">
                <div class="gallery-item">
                    <img src="https://via.placeholder.com/300x300/1e40af/ffffff?text=Karya+Siswa+1" alt="Gallery 1">
                </div>
                <div class="gallery-item">
                    <img src="https://via.placeholder.com/300x300/3b82f6/ffffff?text=Karya+Siswa+2" alt="Gallery 2">
                </div>
                <div class="gallery-item">
                    <img src="https://via.placeholder.com/300x300/60a5fa/ffffff?text=Karya+Siswa+3" alt="Gallery 3">
                </div>
                <div class="gallery-item">
                    <img src="https://via.placeholder.com/300x300/1e40af/ffffff?text=Karya+Siswa+4" alt="Gallery 4">
                </div>
            </div>
        </section>

        <!-- About Section -->
        <section class="card" id="about">
            <h2>‚ÑπÔ∏è Tentang HSA Twibbon</h2>
            <p style="line-height: 1.8; color: var(--text-light);">
                HSA Twibbon Generator adalah platform resmi untuk membuat twibbon berbagai kegiatan di SMK HSA. 
                Dibuat dengan teknologi web modern, platform ini memudahkan siswa, guru, dan alumni untuk 
                berpartisipasi dalam setiap acara dengan cara yang kreatif dan menyenangkan.
            </p>
            <p style="line-height: 1.8; color: var(--text-light); margin-top: 15px;">
                Dengan identitas warna biru yang mencerminkan seragam wearpack khas SMK HSA, 
                setiap twibbon yang dibuat akan membawa kebanggaan dan semangat kebersamaan kita.
            </p>
        </section>
    </div>

    <!-- Footer -->
    <footer id="contact">
        <div class="footer-content">
            <div class="footer-section">
                <h3>üè´ SMK HSA</h3>
                <p>Sekolah Menengah Kejuruan</p>
                <p>Jl. Pendidikan No. 123</p>
                <p>Kota, Provinsi 12345</p>
                <p>üìû Telp: (021) 1234-5678</p>
                <p>üìß Email: info@smkhsa.sch.id</p>
            </div>
            
            <div class="footer-section">
                <h3>üîó Link Cepat</h3>
                <a href="#home">Home</a>
                <a href="#creator">Buat Twibbon</a>
                <a href="#gallery">Gallery</a>
                <a href="#about">Tentang Kami</a>
                <a href="https://smkhsa.sch.id" target="_blank">Website Sekolah</a>
            </div>
            
            <div class="footer-section">
                <h3>üì± Sosial Media</h3>
                <p>Ikuti kami di sosial media untuk update terbaru!</p>
                <div class="social-links">
                    <a href="https://facebook.com/smkhsa" target="_blank" title="Facebook">üìò</a>
                    <a href="https://instagram.com/smkhsa" target="_blank" title="Instagram">üì∑</a>
                    <a href="https://twitter.com/smkhsa" target="_blank" title="Twitter">üê¶</a>
                    <a href="https://youtube.com/@smkhsa" target="_blank" title="YouTube">üì∫</a>
                    <a href="https://wa.me/6281234567890" target="_blank" title="WhatsApp">üí¨</a>
                </div>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>¬© 2024 SMK HSA. All Rights Reserved.</p>
            <p style="margin-top: 10px;">Made with ‚ù§Ô∏è by HSA IT Team</p>
        </div>
    </footer>

    <script>
        // KONFIGURASI TEMPLATE
        const templates = [
            { id: 1, name: 'HUT RI', file: 'frame1.png' },
            { id: 2, name: 'Wisuda', file: 'frame2.png' },
            { id: 3, name: 'Olahraga', file: 'frame3.png' },
        ];

        let customTemplates = [];
        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');
        let uploadedImage = null;
        let currentFrame = null;
        let selectedTemplateId = 1;
        
        let scale = 1;
        let offsetX = 0;
        let offsetY = 0;

        // Theme Toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (currentTheme === 'dark') {
                html.removeAttribute('data-theme');
                themeToggle.textContent = 'üåô';
                localStorage.setItem('theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                themeToggle.textContent = '‚òÄÔ∏è';
                localStorage.setItem('theme', 'dark');
            }
        }

        // Load saved theme
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
                document.querySelector('.theme-toggle').textContent = '‚òÄÔ∏è';
            }
            loadHistory();
        });

        // Mobile Menu Toggle
        function toggleMenu() {
            const navMenu = document.getElementById('navMenu');
            navMenu.classList.toggle('active');
        }

        // Generate template grid
        function generateTemplateGrid() {
            const grid = document.getElementById('templateGrid');
            grid.innerHTML = '';
            
            const allTemplates = [...templates, ...customTemplates];
            
            allTemplates.forEach((template, index) => {
                const item = document.createElement('div');
                item.className = 'template-item' + (index === 0 ? ' active' : '');
                item.onclick = () => selectTemplate(template.id);
                
                item.innerHTML = `
                    <img src="${template.file}" alt="${template.name}" 
                         onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect width=%22200%22 height=%22200%22 fill=%22%231e40af%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-size=%2220%22 fill=%22white%22%3E${template.name}%3C/text%3E%3C/svg%3E'">
                    <p>${template.name}</p>
                `;
                
                grid.appendChild(item);
            });
        }

        // Select template
        function selectTemplate(templateId) {
            selectedTemplateId = templateId;
            
            document.querySelectorAll('.template-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const allTemplates = [...templates, ...customTemplates];
            const template = allTemplates.find(t => t.id === templateId);
            
            if (template) {
                const items = document.querySelectorAll('.template-item');
                const index = allTemplates.indexOf(template);
                if (items[index]) {
                    items[index].classList.add('active');
                }
                
                currentFrame = new Image();
                currentFrame.crossOrigin = "anonymous";
                currentFrame.src = template.file;
                currentFrame.onload = () => {
                    if (uploadedImage) {
                        drawCanvas();
                    }
                };
            }
        }

        // Upload custom template
        document.getElementById('customFrameInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('Tolong upload file gambar!');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const customId = Date.now();
                customTemplates.push({
                    id: customId,
                    name: 'Custom ' + (customTemplates.length + 1),
                    file: event.target.result
                });
                
                generateTemplateGrid();
                selectTemplate(customId);
                alert('Template custom berhasil ditambahkan! ‚úÖ');
            };
            reader.readAsDataURL(file);
        });

        generateTemplateGrid();
        selectTemplate(1);

        // Upload box handlers
        const uploadBox = document.getElementById('uploadBox');
        const fileInput = document.getElementById('fileInput');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadBox.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadBox.addEventListener(eventName, () => {
                uploadBox.classList.add('dragover');
            });
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadBox.addEventListener(eventName, () => {
                uploadBox.classList.remove('dragover');
            });
        });

        uploadBox.addEventListener('drop', handleDrop);

        function handleDrop(e) {
            const files = e.dataTransfer.files;
            handleFiles(files);
        }

        fileInput.addEventListener('change', function(e) {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            if (files.length === 0) return;
            
            const file = files[0];
            
            if (!file.type.startsWith('image/')) {
                alert('Tolong upload file gambar!');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                alert('Ukuran file maksimal 5MB!');
                return;
            }
            
            document.getElementById('loading').classList.add('active');
            
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedImage = new Image();
                uploadedImage.onload = function() {
                    setTimeout(() => {
                        document.getElementById('loading').classList.remove('active');
                        document.getElementById('previewSection').classList.remove('hidden');
                        document.getElementById('previewSection').scrollIntoView({ behavior: 'smooth' });
                        resetControls();
                        drawCanvas();
                    }, 500);
                };
                uploadedImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Slider controls
        document.getElementById('scaleSlider').addEventListener('input', function(e) {
            scale = parseFloat(e.target.value);
            document.getElementById('scaleValue').textContent = scale.toFixed(1);
            drawCanvas();
        });

        document.getElementById('xSlider').addEventListener('input', function(e) {
            offsetX = parseInt(e.target.value);
            document.getElementById('xValue').textContent = offsetX;
            drawCanvas();
        });

        document.getElementById('ySlider').addEventListener('input', function(e) {
            offsetY = parseInt(e.target.value);
            document.getElementById('yValue').textContent = offsetY;
            drawCanvas();
        });

        function drawCanvas() {
            if (!uploadedImage || !currentFrame) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.save();
            ctx.translate(canvas.width/2 + offsetX, canvas.height/2 + offsetY);
            ctx.scale(scale, scale);
            
            const imgAspect = uploadedImage.width / uploadedImage.height;
            const canvasAspect = canvas.width / canvas.height;
            
            let drawWidth, drawHeight;
            if (imgAspect > canvasAspect) {
                drawHeight = canvas.height;
                drawWidth = drawHeight * imgAspect;
            } else {
                drawWidth = canvas.width;
                drawHeight = drawWidth / imgAspect;
            }
            
            ctx.drawImage(uploadedImage, -drawWidth/2, -drawHeight/2, drawWidth, drawHeight);
            ctx.restore();

            if (currentFrame.complete && currentFrame.naturalHeight !== 0) {
                ctx.drawImage(currentFrame, 0, 0, canvas.width, canvas.height);
            }
        }

        function resetControls() {
            scale = 1;
            offsetX = 0;
            offsetY = 0;
            document.getElementById('scaleSlider').value = 1;
            document.getElementById('xSlider').value = 0;
            document.getElementById('ySlider').value = 0;
            document.getElementById('scaleValue').textContent = '1.0';
            document.getElementById('xValue').textContent = '0';
            document.getElementById('yValue').textContent = '0';
        }

        function downloadImage() {
            const link = document.createElement('a');
            const allTemplates = [...templates, ...customTemplates];
            const template = allTemplates.find(t => t.id === selectedTemplateId);
            const fileName = 'twibbon-hsa-' + template.name.toLowerCase().replace(/\s+/g, '-') + '-' + Date.now() + '.png';
            link.download = fileName;
            link.href = canvas.toDataURL('image/png', 1.0);
            link.click();
            
            alert('‚úÖ Twibbon berhasil didownload!');
        }

        function resetAll() {
            uploadedImage = null;
            document.getElementById('previewSection').classList.add('hidden');
            document.getElementById('fileInput').value = '';
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        // History Management
        function saveToHistory() {
            const dataURL = canvas.toDataURL('image/png');
            const history = JSON.parse(localStorage.getItem('twibbonHistory') || '[]');
            
            history.unshift({
                id: Date.now(),
                image: dataURL,
                date: new Date().toLocaleString('id-ID')
            });
            
            // Limit to 20 items
            if (history.length > 20) {
                history.pop();
            }
            
            localStorage.setItem('twibbonHistory', JSON.stringify(history));
            loadHistory();
            alert('‚úÖ Twibbon berhasil disimpan ke history!');
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('twibbonHistory') || '[]');
            const grid = document.getElementById('historyGrid');
            
            if (history.length === 0) {
                grid.innerHTML = '<p style="color: var(--text-light);">Belum ada history. Buat twibbon pertama kamu!</p>';
                return;
            }
            
            grid.innerHTML = '';
            history.forEach(item => {
                const div = document.createElement('div');
                div.className = 'history-item';
                div.innerHTML = `
                    <img src="${item.image}" alt="History" onclick="viewHistory(${item.id})">
                    <button class="delete-btn" onclick="deleteHistory(${item.id}, event)">‚úï</button>
                `;
                grid.appendChild(div);
            });
        }

        function viewHistory(id) {
            const history = JSON.parse(localStorage.getItem('twibbonHistory') || '[]');
            const item = history.find(h => h.id === id);
            if (item) {
                const link = document.createElement('a');
                link.download = 'twibbon-history-' + id + '.png';
                link.href = item.image;
                link.click();
            }
        }

        function deleteHistory(id, event) {
            event.stopPropagation();
            if (confirm('Hapus twibbon ini dari history?')) {
                let history = JSON.parse(localStorage.getItem('twibbonHistory') || '[]');
                history = history.filter(h => h.id !== id);
                localStorage.setItem('twibbonHistory', JSON.stringify(history));
                loadHistory();
            }
        }

        // Share Functions
        function shareToFacebook() {
            alert('üí° Tip: Download twibbon kamu, lalu upload ke Facebook dengan caption tentang HSA!');
            downloadImage();
        }

        function shareToTwitter() {
            const text = encodeURIComponent('Lihat twibbon keren saya dari SMK HSA! üéì #SMKHSA #Twibbon');
            window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank');
        }

        function shareToWhatsApp() {
            const text = encodeURIComponent('Lihat twibbon keren saya dari SMK HSA! üéì');
            window.open(`https://wa.me/?text=${text}`, '_blank');
            setTimeout(() => {
                alert('üí° Jangan lupa attach file twibbon yang sudah kamu download!');
            }, 1000);
        }

        function shareToInstagram() {
            alert('üí° Tip Instagram:\n1. Download twibbon kamu\n2. Buka Instagram\n3. Upload sebagai post/story\n4. Tag @smkhsa dan gunakan hashtag #SMKHSA');
            downloadImage();
        }

        // Smooth scroll for navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    // Close mobile menu after click
                    document.getElementById('navMenu').classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
